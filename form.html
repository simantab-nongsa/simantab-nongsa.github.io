<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Laporan</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-5">
  <h1 class="text-center mb-4">Form Laporan SIMANTAB NONGSA</h1>
  <form id="laporanForm" class="card p-4 shadow">
    <div class="mb-3"><label class="form-label">Nama</label><input type="text" class="form-control" id="nama" required></div>
    <div class="mb-3"><label class="form-label">Alamat</label><input type="text" class="form-control" id="alamat" required></div>
    <div class="mb-3">
      <label class="form-label">Kategori</label>
      <select class="form-select" id="kategori" required>
        <option value="">Pilih...</option>
        <option>Ketertiban</option>
        <option>Keamanan</option>
        <option>Kebersihan</option>
      </select>
    </div>
    <div class="mb-3"><label class="form-label">Deskripsi</label><textarea class="form-control" id="deskripsi" rows="3" required></textarea></div>
    <div class="mb-3"><label class="form-label">Upload Foto</label><input type="file" class="form-control" id="foto" accept="image/*"></div>
    <button type="submit" class="btn btn-primary w-100">Kirim Laporan</button>
  </form>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbyLvmIaVwG1XzwhAUcFkvv3AvJct78OGj4Alc41ePqU74xqy4B9t0Ict7HWP4UkiRw/exec";

  document.getElementById("laporanForm").addEventListener("submit", async function(e){
    e.preventDefault();
    const fileInput = document.getElementById("foto").files[0];
    let fotoBase64 = "";
    if (fileInput) {
      fotoBase64 = await toBase64(fileInput);
    }

    const data = {
      nama: document.getElementById("nama").value,
      alamat: document.getElementById("alamat").value,
      kategori: document.getElementById("kategori").value,
      deskripsi: document.getElementById("deskripsi").value,
      foto: fotoBase64
    };

    fetch(API_URL, { method: "POST", body: JSON.stringify(data) })
      .then(res => res.text())
      .then(msg => {
        alert("Laporan berhasil dikirim!");
        document.getElementById("laporanForm").reset();
      })
      .catch(err => alert("Error: " + err));
  });

  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result.split(",")[1]);
      reader.onerror = error => reject(error);
    });
  }
</script>
</body>
</html>
